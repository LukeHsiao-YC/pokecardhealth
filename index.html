<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¶å¯å¤¢å¥åº·å¤§æˆ° (PTCGè¦å‰‡ç‰ˆ)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        
        /* æˆ°é¬¥èƒŒæ™¯ */
        .battle-bg {
            background: radial-gradient(circle at center, #ffffff 0%, #f0f9ff 40%, #bae6fd 100%);
            background-size: cover;
        }

        /* å¡ç‰Œæ¨£å¼ */
        .card-shadow {
            box-shadow: 2px 4px 10px rgba(0,0,0,0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card-shadow:hover {
            transform: translateY(-10px);
            box-shadow: 4px 8px 15px rgba(0,0,0,0.4);
        }

        /* å‹•ç•« */
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-8px, 0, 0); }
            40%, 60% { transform: translate3d(8px, 0, 0); }
        }

        .pop-text {
            animation: popUp 1.2s forwards;
            pointer-events: none;
            text-shadow: 2px 2px 0px white, -1px -1px 0px white, 1px -1px 0px white, -1px 1px 0px white, 1px 1px 0px white;
        }
        @keyframes popUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-100px) scale(1.5); }
        }

        .player-attack { animation: lungeRight 0.3s forwards; }
        @keyframes lungeRight {
            0% { transform: translateX(0); }
            50% { transform: translateX(50px); }
            100% { transform: translateX(0); }
        }

        .enemy-attack { animation: lungeLeft 0.3s forwards; }
        @keyframes lungeLeft {
            0% { transform: translateX(0); }
            50% { transform: translateX(-50px); }
            100% { transform: translateX(0); }
        }
        
        /* èƒ½é‡çƒæ¨£å¼ */
        .energy-orb {
            box-shadow: inset -2px -2px 6px rgba(0,0,0,0.3);
        }

        /* æ»¾å‹•æ¢éš±è— */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="h-screen overflow-hidden select-none bg-slate-800">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- åœ–ç‰‡è³‡æº ---
        const IMG_PLAYER = "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/68.png"; // æ€ªåŠ›
        const IMG_ENEMY = "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/143.png"; // å¡æ¯”ç¸
        
        // --- éŠæˆ²å¸¸æ•¸ ---
        const MAX_HP_PLAYER = 150; // æ€ªåŠ› HP
        const MAX_HP_ENEMY = 180;  // å¡æ¯”ç¸ HP
        
        // --- æ€ªåŠ› (ç©å®¶) çš„æ‹›å¼è¡¨ (éæ‰‹ç‰Œ) ---
        const PLAYER_MOVES = [
            { id: 'm1', name: "ä½ç©ºè¸¢", damage: 30, cost: 1, desc: "è¸¢æ“Šå°æ‰‹è†è“‹ã€‚é€ æˆ30é»å‚·å®³ã€‚" },
            { id: 'm2', name: "å€ŸåŠ›æ‘”", damage: 60, cost: 2, desc: "åˆ©ç”¨å°æ‰‹çš„åŠ›é‡ã€‚é€ æˆ60é»å‚·å®³ã€‚" },
            { id: 'm3', name: "æ¥µå·¨å¥åº·æ‹³", damage: 100, cost: 3, desc: "å¼·å¤§çš„å¥åº·ä¸€æ“Šï¼é€ æˆ100é»å‚·å®³ï¼Œæ¢å¾©è‡ªå·±20é»HPã€‚", heal: 20 }
        ];

        // --- å¡ç‰Œå®šç¾© (æ‰‹ç‰Œ) ---
        // é¡å‹: energy, item, supporter
        const DECK_TEMPLATE = [
            // 15å¼µèƒ½é‡å¡
            ...Array(15).fill({ type: 'energy', name: "é¬¥èƒ½é‡", desc: "é™„è‘—æ–¼å¯¶å¯å¤¢èº«ä¸Šä»¥ä½¿ç”¨æ‹›å¼ã€‚", color: "bg-orange-600" }),
            // ç‰©å“å¡ (Item) - ç„¡é™ä½¿ç”¨
            ...Array(4).fill({ type: 'item', id: 'potion', name: "å‚·è—¥", desc: "æ¢å¾©è‡ªå·±çš„å¯¶å¯å¤¢30é»HPã€‚", color: "bg-blue-500", effect: 'heal', val: 30 }),
            ...Array(2).fill({ type: 'item', id: 'cycling', name: "è…³è¸è»Š", desc: "æŠ½1å¼µå¡ã€‚", color: "bg-blue-500", effect: 'draw', val: 1 }),
            ...Array(2).fill({ type: 'item', id: 'dumbbell', name: "å•éˆ´", desc: "æœ¬å›åˆæ‹›å¼å‚·å®³+20ã€‚", color: "bg-blue-500", effect: 'buff_dmg', val: 20 }),
            // æ”¯æ´è€…å¡ (Supporter) - ä¸€å›åˆä¸€å¼µ
            ...Array(3).fill({ type: 'supporter', id: 'research', name: "åšå£«çš„ç ”ç©¶", desc: "ä¸Ÿæ£„æ‰‹ç‰Œ(æ­¤éŠæˆ²ä¸­ä¸ä¸Ÿæ£„)ï¼Œå¾ç‰Œåº«æŠ½3å¼µå¡ã€‚", color: "bg-red-500", effect: 'draw', val: 3 }),
            ...Array(2).fill({ type: 'supporter', id: 'nurse', name: "å¯¶å¯å¤¢ä¸­å¿ƒå°å§", desc: "å°‡è‡ªå·±çš„å¯¶å¯å¤¢HPæ¢å¾©60é»ã€‚", color: "bg-red-500", effect: 'heal', val: 60 }),
            ...Array(2).fill({ type: 'supporter', id: 'boss', name: "è€å¤§çš„æŒ‡ä»¤", desc: "è¿«ä½¿å°æ‰‹åšæœ‰æ°§é‹å‹•ï¼é€ æˆå°æ‰‹20é»å‚·å®³ä¸¦æŠ½1å¼µå¡ã€‚", color: "bg-red-500", effect: 'attack_draw', val: 20 }),
        ];

        // --- ç°¡æ˜“åœ–æ¨™ ---
        const Icons = {
            Energy: () => <span className="inline-block w-4 h-4 rounded-full bg-orange-600 border border-white energy-orb mr-1 align-middle"></span>,
            Item: () => <span className="text-blue-200 font-bold text-xs">[ç‰©å“]</span>,
            Supporter: () => <span className="text-red-200 font-bold text-xs">[æ”¯æ´è€…]</span>
        };

        const App = () => {
            // å ´æ™¯: menu, battle, win, lose
            const [scene, setScene] = useState('menu'); 
            
            // ç©å®¶ç‹€æ…‹
            const [pHP, setPHP] = useState(MAX_HP_PLAYER);
            const [pEnergy, setPEnergy] = useState(0); // é™„è‘—åœ¨èº«ä¸Šçš„èƒ½é‡æ•¸
            const [hand, setHand] = useState([]);
            const [deck, setDeck] = useState([]);
            const [discardPile, setDiscardPile] = useState(0);
            
            // å›åˆç‹€æ…‹
            const [turn, setTurn] = useState('player'); // player, enemy
            const [energyAttachedThisTurn, setEnergyAttachedThisTurn] = useState(false);
            const [supporterUsedThisTurn, setSupporterUsedThisTurn] = useState(false);
            const [damageBuff, setDamageBuff] = useState(0); // æœ¬å›åˆå‚·å®³åŠ æˆ
            
            // æ•µäººç‹€æ…‹
            const [eHP, setEHP] = useState(MAX_HP_ENEMY);
            const [enemyNextMove, setEnemyNextMove] = useState(null);

            // UI & å‹•ç•«ç‹€æ…‹
            const [msg, setMsg] = useState("");
            const [floater, setFloater] = useState(null); // { text, x, y, color }
            const [pAnim, setPAnim] = useState('');
            const [eAnim, setEAnim] = useState('');
            const [showRuleModal, setShowRuleModal] = useState(false);

            // åˆå§‹åŒ–æˆ°é¬¥
            const startBattle = () => {
                setPHP(MAX_HP_PLAYER);
                setEHP(MAX_HP_ENEMY);
                setPEnergy(0);
                setDiscardPile(0);
                setTurn('player');
                setMsg("æˆ°é¬¥é–‹å§‹ï¼è«‹å¾æ‰‹ç‰Œé™„è‘—èƒ½é‡æˆ–ä½¿ç”¨é“å…·ï¼");
                setEnergyAttachedThisTurn(false);
                setSupporterUsedThisTurn(false);
                setDamageBuff(0);

                // æ´—ç‰Œ
                const newDeck = [...DECK_TEMPLATE].sort(() => Math.random() - 0.5);
                // åˆå§‹æŠ½ç‰Œ (7å¼µï¼Œæ¨¡æ“¬PTCG)
                const initialHand = newDeck.slice(0, 7);
                const remainingDeck = newDeck.slice(7);
                
                setHand(initialHand);
                setDeck(remainingDeck);
                
                planEnemyAction();
                setScene('battle');
            };

            // æ•µäººAI
            const planEnemyAction = () => {
                const actions = [
                    { name: "è¡æ’", dmg: 20, text: "å¡æ¯”ç¸ä½¿ç”¨äº†è¡æ’ï¼" },
                    { name: "æ³°å±±å£“é ‚", dmg: 40, text: "å¡æ¯”ç¸ä½¿ç”¨äº†æ³°å±±å£“é ‚ï¼" },
                    { name: "ç¡è¦º", dmg: 0, heal: 30, text: "å¡æ¯”ç¸ç¡è‘—äº†ï¼Œæ¢å¾©äº†é«”åŠ›ï¼" },
                    { name: "æ‰“å‘¼", dmg: 10, text: "å¡æ¯”ç¸æ‰“å‘¼è²å¤ªåµäº†ï¼" }
                ];
                const action = actions[Math.floor(Math.random() * actions.length)];
                setEnemyNextMove(action);
            };

            // æŠ½ç‰ŒåŠŸèƒ½
            const drawCard = (count = 1) => {
                if (deck.length === 0) {
                    setMsg("ç‰Œåº«æ²’ç‰Œäº†ï¼ç„¡æ³•æŠ½ç‰Œï¼");
                    return;
                }
                const draw = deck.slice(0, count);
                const left = deck.slice(count);
                setHand(prev => [...prev, ...draw]);
                setDeck(left);
                return draw.length; // å›å‚³å¯¦éš›æŠ½åˆ°çš„å¼µæ•¸
            };

            // æµ®å‹•æ–‡å­—æ•ˆæœ
            const showFloater = (text, type) => {
                const color = type === 'damage' ? 'text-red-600' : type === 'heal' ? 'text-green-500' : 'text-blue-500';
                const target = type === 'damage' ? (turn === 'player' ? 'enemy' : 'player') : (turn === 'player' ? 'player' : 'enemy');
                setFloater({ text, color, target });
                setTimeout(() => setFloater(null), 1000);
            };

            // --- ç©å®¶å‹•ä½œ ---

            // 1. é™„è‘—èƒ½é‡ (å¾æ‰‹ç‰Œ)
            const attachEnergy = (cardIndex) => {
                if (turn !== 'player') return;
                if (energyAttachedThisTurn) {
                    setMsg("é€™å€‹å›åˆå·²ç¶“é™„è‘—éèƒ½é‡äº†ï¼");
                    return;
                }
                
                // ç§»é™¤æ‰‹ç‰Œ
                const newHand = [...hand];
                newHand.splice(cardIndex, 1);
                setHand(newHand);

                setPEnergy(prev => prev + 1);
                setEnergyAttachedThisTurn(true);
                setMsg("å°‡é¬¥èƒ½é‡é™„è‘—åœ¨æ€ªåŠ›èº«ä¸Šï¼");
                showFloater("+1 èƒ½é‡", "buff");
            };

            // 2. ä½¿ç”¨ç‰©å“/æ”¯æ´è€… (å¾æ‰‹ç‰Œ)
            const playTrainer = (card, index) => {
                if (turn !== 'player') return;
                
                // æª¢æŸ¥æ”¯æ´è€…é™åˆ¶
                if (card.type === 'supporter' && supporterUsedThisTurn) {
                    setMsg("æ¯å€‹å›åˆåªèƒ½ä½¿ç”¨ä¸€å¼µæ”¯æ´è€…å¡ï¼");
                    return;
                }

                // ç§»é™¤æ‰‹ç‰Œ
                const newHand = [...hand];
                newHand.splice(index, 1);
                setHand(newHand);
                setDiscardPile(prev => prev + 1);

                // åŸ·è¡Œæ•ˆæœ
                let effectMsg = "";
                if (card.type === 'supporter') setSupporterUsedThisTurn(true);

                switch (card.effect) {
                    case 'heal':
                        const healAmount = card.val;
                        setPHP(prev => Math.min(MAX_HP_PLAYER, prev + healAmount));
                        showFloater(`+${healAmount}`, 'heal');
                        effectMsg = `ä½¿ç”¨äº†${card.name}ï¼Œæ¢å¾©${healAmount}é»HPï¼`;
                        break;
                    case 'draw':
                        const drawn = drawCard(card.val);
                        effectMsg = `ä½¿ç”¨äº†${card.name}ï¼ŒæŠ½äº†${drawn}å¼µå¡ï¼`;
                        break;
                    case 'buff_dmg':
                        setDamageBuff(prev => prev + card.val);
                        effectMsg = `ä½¿ç”¨äº†${card.name}ï¼Œæœ¬å›åˆå‚·å®³+${card.val}ï¼`;
                        showFloater(`å‚·å®³UP`, 'buff');
                        break;
                    case 'attack_draw':
                        // è€å¤§çš„æŒ‡ä»¤ (ç‰¹æ®Šæ•ˆæœ)
                        setEHP(prev => Math.max(0, prev - card.val));
                        drawCard(1);
                        setEAnim('shake');
                        showFloater(`-${card.val}`, 'damage');
                        effectMsg = `ä½¿ç”¨äº†${card.name}ï¼é€ æˆå‚·å®³ä¸¦æŠ½å¡ï¼`;
                        break;
                    default:
                        effectMsg = `ä½¿ç”¨äº†${card.name}ï¼`;
                }
                setMsg(effectMsg);
            };

            // 3. ä½¿ç”¨æ‹›å¼ (æ€ªåŠ›æœ¬é«”) - æœƒçµæŸå›åˆ
            const useMove = (move) => {
                if (turn !== 'player') return;
                if (pEnergy < move.cost) {
                    setMsg("èƒ½é‡ä¸è¶³ï¼ç„¡æ³•ä½¿ç”¨é€™å€‹æ‹›å¼ï¼");
                    return;
                }

                // æ”»æ“Šé‚è¼¯
                const totalDamage = move.damage + damageBuff;
                setEHP(prev => Math.max(0, prev - totalDamage));
                
                // å‹•ç•«
                setPAnim('player-attack');
                setTimeout(() => setPAnim(''), 300);
                setTimeout(() => {
                    setEAnim('shake');
                    showFloater(`-${totalDamage}`, 'damage');
                    setTimeout(() => setEAnim(''), 500);
                }, 150);

                // é¡å¤–æ•ˆæœ (å¦‚æ¢å¾©)
                if (move.heal) {
                    setPHP(prev => Math.min(MAX_HP_PLAYER, prev + move.heal));
                    setTimeout(() => showFloater(`+${move.heal}`, 'heal'), 200);
                }

                setMsg(`æ€ªåŠ›ä½¿ç”¨äº†${move.name}ï¼é€ æˆ${totalDamage}é»å‚·å®³ï¼`);

                // æª¢æŸ¥å‹åˆ©
                if (eHP - totalDamage <= 0) {
                    setTimeout(() => setScene('win'), 1000);
                    return;
                }

                // çµæŸå›åˆ
                setTimeout(endPlayerTurn, 1500);
            };

            const endPlayerTurn = () => {
                setTurn('enemy');
                setMsg("å›åˆçµæŸï¼Œè¼ªåˆ°å°æ‰‹äº†...");
                setDamageBuff(0); // æ¸…é™¤å‚·å®³åŠ æˆ
                
                setTimeout(enemyAction, 1500);
            };

            const enemyAction = () => {
                const move = enemyNextMove;
                
                // æ•µäººæ”»æ“Šå‹•ç•«
                setEAnim('enemy-attack');
                setTimeout(() => setEAnim(''), 300);

                setTimeout(() => {
                    if (move.dmg > 0) {
                        setPHP(prev => Math.max(0, prev - move.dmg));
                        setPAnim('shake');
                        showFloater(`-${move.dmg}`, 'damage');
                        setTimeout(() => setPAnim(''), 500);
                    }
                    if (move.heal) {
                        setEHP(prev => Math.min(MAX_HP_ENEMY, prev + move.heal));
                        showFloater(`+${move.heal}`, 'heal');
                    }
                }, 150);

                setMsg(move.text);

                // æª¢æŸ¥å¤±æ•—
                if (pHP - move.dmg <= 0) {
                    setTimeout(() => setScene('lose'), 1000);
                    return;
                }

                // å›åˆ°ç©å®¶å›åˆ
                setTimeout(() => {
                    setTurn('player');
                    setEnergyAttachedThisTurn(false);
                    setSupporterUsedThisTurn(false);
                    planEnemyAction();
                    
                    // å›åˆé–‹å§‹æŠ½ç‰Œ
                    setMsg("ä½ çš„å›åˆï¼æŠ½1å¼µå¡ã€‚");
                    drawCard(1);
                    
                }, 2000);
            };

            // --- æ¸²æŸ“çµ„ä»¶ ---
            
            // æ‰‹ç‰Œæ¸²æŸ“
            const renderHandCard = (card, index) => {
                const isEnergy = card.type === 'energy';
                const isTrainer = card.type === 'item' || card.type === 'supporter';
                
                // åˆ¤æ–·æ˜¯å¦å¯ç”¨
                let disabled = turn !== 'player';
                if (isEnergy && energyAttachedThisTurn) disabled = true;
                if (card.type === 'supporter' && supporterUsedThisTurn) disabled = true;

                return (
                    <div 
                        key={index}
                        onClick={() => {
                            if (disabled) return;
                            if (isEnergy) attachEnergy(index);
                            if (isTrainer) playTrainer(card, index);
                        }}
                        className={`
                            flex-shrink-0 w-24 h-36 md:w-28 md:h-40 rounded-lg border-2 border-white 
                            flex flex-col p-2 relative cursor-pointer card-shadow select-none
                            ${card.color} text-white
                            ${disabled ? 'opacity-50 grayscale cursor-not-allowed' : 'hover:-translate-y-4'}
                        `}
                    >
                        <div className="text-[10px] font-bold mb-1 opacity-80">
                            {isEnergy ? "èƒ½é‡" : card.type === 'item' ? "ç‰©å“" : "æ”¯æ´è€…"}
                        </div>
                        <div className="font-bold text-sm leading-tight mb-2">{card.name}</div>
                        <div className="flex-1 flex items-center justify-center text-2xl">
                            {isEnergy ? "âš¡" : "ğŸ’"}
                        </div>
                        <div className="text-[10px] leading-tight opacity-90">
                            {card.desc}
                        </div>
                    </div>
                );
            };

            // --- ç•«é¢æ¸²æŸ“ ---

            if (scene === 'menu') {
                return (
                    <div className="h-full flex flex-col items-center justify-center battle-bg relative">
                        <div className="bg-white/90 p-8 rounded-2xl shadow-2xl text-center max-w-md mx-4 backdrop-blur-sm">
                            <h1 className="text-4xl font-bold text-slate-800 mb-2">å¯¶å¯å¤¢å¥åº·å¤§æˆ°</h1>
                            <p className="text-slate-500 mb-6">PTCG è¦å‰‡ç‰¹åˆ¥ç‰ˆ</p>
                            <div className="flex justify-center gap-8 mb-8">
                                <img src={IMG_PLAYER} className="w-24 h-24 animate-bounce" alt="æ€ªåŠ›" />
                                <span className="text-4xl font-bold text-slate-400 self-center">VS</span>
                                <img src={IMG_ENEMY} className="w-24 h-24 animate-pulse" alt="å¡æ¯”ç¸" />
                            </div>
                            <button 
                                onClick={startBattle}
                                className="w-full bg-red-600 hover:bg-red-700 text-white text-xl font-bold py-3 px-8 rounded-full shadow-lg transition transform hover:scale-105"
                            >
                                é–‹å§‹å°æˆ°
                            </button>
                            <div className="mt-4 text-xs text-slate-500 text-left">
                                <p>è¦å‰‡èªªæ˜ï¼š</p>
                                <ul className="list-disc pl-4 mt-1">
                                    <li>å›åˆé–‹å§‹æŠ½1å¼µå¡ã€‚</li>
                                    <li>æ¯å›åˆå¯ç”±æ‰‹ç‰Œé™„è‘—1å¼µèƒ½é‡ã€‚</li>
                                    <li>ç‰©å“å¡ä¸é™ä½¿ç”¨æ¬¡æ•¸ï¼Œæ”¯æ´è€…å¡æ¯å›åˆé™1å¼µã€‚</li>
                                    <li>ç´¯ç©è¶³å¤ èƒ½é‡ä½¿ç”¨æ€ªåŠ›çš„æ‹›å¼æ”»æ“Šï¼</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                );
            }
            
            if (scene === 'win' || scene === 'lose') {
                 return (
                    <div className={`h-full flex flex-col items-center justify-center p-4 ${scene === 'win' ? 'bg-yellow-100' : 'bg-slate-900'}`}>
                        <h1 className={`text-6xl font-bold mb-4 ${scene === 'win' ? 'text-yellow-600' : 'text-slate-200'}`}>
                            {scene === 'win' ? 'å‹åˆ©ï¼' : 'æ•—åŒ—...'}
                        </h1>
                        <img src={scene === 'win' ? IMG_PLAYER : IMG_ENEMY} className="w-48 h-48 mb-8 animate-bounce" />
                        <button 
                            onClick={() => setScene('menu')} 
                            className="bg-white text-slate-800 font-bold py-3 px-8 rounded-full shadow-lg text-xl hover:scale-105 transition"
                        >
                            å›åˆ°ä¸»é¸å–®
                        </button>
                    </div>
                );
            }

            return (
                <div className="h-full flex flex-col battle-bg relative overflow-hidden">
                    
                    {/* æµ®å‹•æ–‡å­—å±¤ */}
                    {floater && (
                        <div className={`absolute z-50 text-5xl font-black pop-text ${floater.color}`}
                             style={{ 
                                 top: floater.target === 'enemy' ? '25%' : '55%', 
                                 left: '50%', 
                                 transform: 'translate(-50%, -50%)',
                             }}>
                            {floater.text}
                        </div>
                    )}

                    {/* ä¸Šæ–¹å€åŸŸï¼šæ•µäºº (30%) */}
                    <div className="flex-none h-[30%] relative flex items-center justify-center">
                        <div className={`relative transition-transform duration-200 ${eAnim}`}>
                            <img src={IMG_ENEMY} className="w-32 h-32 md:w-48 md:h-48 drop-shadow-xl filter brightness-110" alt="æ•µäºº" />
                            {/* æ•µäººè¡€æ¢ */}
                            <div className="absolute -bottom-8 left-1/2 transform -translate-x-1/2 w-48 bg-slate-800/80 rounded-lg p-2 text-white text-center shadow-lg border border-slate-600">
                                <div className="text-sm font-bold flex justify-between px-2">
                                    <span>å¡æ¯”ç¸</span>
                                    <span>{eHP}/{MAX_HP_ENEMY}</span>
                                </div>
                                <div className="w-full bg-slate-600 h-2 rounded-full mt-1 overflow-hidden">
                                    <div className="bg-red-500 h-full transition-all duration-500" style={{width: `${(eHP/MAX_HP_ENEMY)*100}%`}}></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* è¨Šæ¯æ¬„ (ä¸æ“‹ä½ç•«é¢) */}
                    <div className="flex-none h-[10%] flex items-center justify-center z-20">
                         <div className="bg-slate-900/80 text-white px-6 py-2 rounded-full backdrop-blur-sm border border-slate-500 shadow-lg text-sm md:text-base animate-pulse">
                            {msg}
                        </div>
                    </div>

                    {/* ä¸­é–“å€åŸŸï¼šç©å®¶å¯¶å¯å¤¢ & ç‹€æ…‹ (35%) */}
                    <div className="flex-none h-[35%] relative flex items-center justify-center px-4">
                        <div className="flex w-full max-w-4xl justify-between items-end">
                            
                            {/* ç©å®¶å¯¶å¯å¤¢åœ–æ¡ˆ */}
                            <div className={`relative transition-transform duration-200 ${pAnim}`}>
                                <img src={IMG_PLAYER} className="w-40 h-40 md:w-56 md:h-56 drop-shadow-2xl" alt="ç©å®¶" />
                                
                                {/* ç©å®¶è¡€æ¢èˆ‡èƒ½é‡ */}
                                <div className="absolute -top-12 left-1/2 transform -translate-x-1/2 w-56 bg-white/90 rounded-lg p-2 text-slate-800 shadow-xl border-2 border-slate-200">
                                    <div className="flex justify-between items-end mb-1">
                                        <span className="font-bold text-lg">æ€ªåŠ›</span>
                                        <span className={`font-bold ${pHP < 50 ? 'text-red-500' : 'text-green-600'}`}>{pHP}/{MAX_HP_PLAYER}</span>
                                    </div>
                                    <div className="w-full bg-slate-300 h-3 rounded-full overflow-hidden mb-2">
                                        <div className="bg-green-500 h-full transition-all duration-500" style={{width: `${(pHP/MAX_HP_PLAYER)*100}%`}}></div>
                                    </div>
                                    {/* èƒ½é‡é¡¯ç¤º */}
                                    <div className="flex items-center gap-1 bg-slate-100 rounded px-2 py-1">
                                        <span className="text-xs font-bold text-slate-500">å·²é™„èƒ½é‡:</span>
                                        <div className="flex gap-1">
                                            {[...Array(pEnergy)].map((_, i) => (
                                                <span key={i} className="w-4 h-4 rounded-full bg-orange-500 border border-white shadow-sm"></span>
                                            ))}
                                            {pEnergy === 0 && <span className="text-xs text-slate-400">ç„¡</span>}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* æ‹›å¼è¡¨ (å›ºå®šåœ¨å³å´) */}
                            <div className="bg-white/90 p-3 rounded-xl shadow-xl border-2 border-slate-200 w-48 md:w-64 flex flex-col gap-2 mb-4">
                                <div className="text-xs text-slate-400 font-bold mb-1 text-center">--- æ‹›å¼åˆ—è¡¨ ---</div>
                                {PLAYER_MOVES.map(move => (
                                    <button 
                                        key={move.id}
                                        onClick={() => useMove(move)}
                                        disabled={turn !== 'player' || pEnergy < move.cost}
                                        className={`
                                            w-full text-left p-2 rounded-lg border transition-all relative overflow-hidden group
                                            ${pEnergy >= move.cost 
                                                ? 'bg-orange-50 hover:bg-orange-100 border-orange-200 cursor-pointer' 
                                                : 'bg-slate-100 border-slate-200 opacity-60 cursor-not-allowed'}
                                        `}
                                    >
                                        <div className="flex justify-between items-center mb-1">
                                            <span className="font-bold text-slate-800">{move.name}</span>
                                            <span className="text-lg font-bold text-slate-700">{move.damage}</span>
                                        </div>
                                        <div className="flex items-center gap-1 text-xs text-slate-500">
                                            <div className="flex">
                                                {[...Array(move.cost)].map((_, i) => (
                                                    <span key={i} className="w-3 h-3 rounded-full bg-orange-500 inline-block mr-0.5"></span>
                                                ))}
                                            </div>
                                            <span>èƒ½é‡</span>
                                        </div>
                                    </button>
                                ))}
                                {damageBuff > 0 && (
                                    <div className="text-center text-xs font-bold text-red-500 animate-pulse">
                                        ç›®å‰å‚·å®³ +{damageBuff}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* åº•éƒ¨å€åŸŸï¼šæ‰‹ç‰Œ (25%) */}
                    <div className="flex-none h-[25%] bg-slate-900/50 backdrop-blur-md border-t border-slate-600 flex flex-col relative">
                        <div className="flex justify-between items-center px-4 py-1">
                            <div className="text-xs text-white/70 font-bold">
                                æ‰‹ç‰Œ: {hand.length} | ç‰Œåº«: {deck.length} | æ£„ç‰Œ: {discardPile}
                            </div>
                            <button 
                                onClick={endPlayerTurn}
                                disabled={turn !== 'player'}
                                className={`
                                    px-4 py-1 rounded text-xs font-bold
                                    ${turn === 'player' ? 'bg-yellow-500 hover:bg-yellow-600 text-slate-900' : 'bg-slate-700 text-slate-400'}
                                `}
                            >
                                çµæŸå›åˆ
                            </button>
                        </div>
                        
                        {/* æ‰‹ç‰Œåˆ—è¡¨ (æ°´å¹³æ»¾å‹•) */}
                        <div className="flex-1 flex items-center gap-2 px-4 overflow-x-auto no-scrollbar pb-2">
                            {hand.map((card, index) => renderHandCard(card, index))}
                        </div>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
